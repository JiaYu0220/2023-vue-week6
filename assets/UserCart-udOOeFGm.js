import{_ as x,m as C,e as k,c as d,b as o,F as g,a as e,f as E,h as b,t as i,w as _,r as u,o as r,d as m,g as U,j as P,n as h}from"./index-rQ1ecwA4.js";import{c as T}from"./cartStore-TSL6et-M.js";import{L as q,a as A,l as w}from"./alertStore-FvkRcQaP.js";var B={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/2023-vue-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:F,VITE_PATH:I}=B,N={data(){return{user:{},message:""}},mounted(){this.showLoading(),this.getCart()},methods:{isPhone(t){return/^(0)[0-9]{9}$/.test(t)?!0:"需要正確的電話號碼"},async postOrder(){if(this.cart.carts.length)try{if((await this.confirmSwal("確定提交訂單？")).isConfirmed){const l=`${F}/api/${I}/order`,v={user:this.user,message:this.message},y=await this.$http.post(l,{data:v});this.$refs.form.resetForm(),this.getCart(),this.$swal(y.data.message)}}catch(t){this.$swal(t.data.message||"發生錯誤")}else this.$swal("請選購商品後再提交表單")},...C(A,["confirmSwal"]),...C(w,["showLoading"])},computed:{...k(T,["cart","getCart","debouncePutCart","delCart","delAllCart"]),...k(w,["loadingStatus","isLoading"])},components:{LoadingButton:q}},O={class:"text-end"},D={class:"table align-middle"},R=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"200px"}},"數量"),e("th",null,"單位"),e("th",{style:{width:"150px"}},"單價"),e("th",{style:{width:"150px"}},"小計")])],-1),M=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),j={key:0,class:"text-success"},$={class:"input-group input-group-sm"},H={class:"input-group mb-3"},z=["onUpdate:modelValue"],G={class:"text-end"},J={key:0,class:"text-success"},K={class:"text-end"},Q=e("td",{colspan:"5",class:"text-end"},"總計",-1),W={class:"text-end"},X=e("td",{colspan:"5",class:"text-end text-success"},"折扣價",-1),Y={class:"text-end text-success"},Z={key:1,class:"bg-light p-5 text-center fs-5"},ee={class:"my-5 row justify-content-center"},se={class:"mb-3"},te=e("label",{for:"email",class:"form-label"},"Email",-1),le={class:"mb-3"},ae=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),oe={class:"mb-3"},ne=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),de={class:"mb-3"},re=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ie={class:"mb-3"},ce=e("label",{for:"message",class:"form-label"},"留言",-1),ue=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function me(t,l,v,y,n,V){const S=u("LoadingOverlay"),f=u("LoadingButton"),c=u("VField"),p=u("ErrorMessage"),L=u("VForm");return r(),d(g,null,[o(S,{active:t.isLoading},null,8,["active"]),t.cart.carts&&t.cart.carts.length?(r(),d(g,{key:0},[e("div",O,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:l[0]||(l[0]=(...s)=>t.delAllCart&&t.delAllCart(...s))},"清空購物車")]),e("table",D,[R,e("tbody",null,[t.cart.carts?(r(!0),d(g,{key:0},E(t.cart.carts,s=>(r(),d("tr",{key:s.id},[e("td",null,[o(f,{class:"btn-outline-danger btn-sm","loading-status":t.loadingStatus.cartId===s.id,onClick:a=>t.delCart(s)},{default:_(()=>[M,m(" x ")]),_:2},1032,["loading-status","onClick"])]),e("td",null,[m(i(s.product.title)+" ",1),s.coupon?(r(),d("div",j," 已套用優惠券 ")):b("",!0)]),e("td",null,[e("div",$,[e("div",H,[o(f,{class:"btn-outline-primary","loading-status":t.loadingStatus.cartId===s.id,onClick:a=>{s.qty--,t.debouncePutCart(s)}},{default:_(()=>[m("-")]),_:2},1032,["loading-status","onClick"]),U(e("input",{min:"1",type:"number",class:"form-control",readonly:"","onUpdate:modelValue":a=>s.qty=a},null,8,z),[[P,s.qty]]),o(f,{class:"btn-outline-primary","loading-status":t.loadingStatus.cartId===s.id,onClick:a=>{s.qty++,t.debouncePutCart(s)}},{default:_(()=>[m("+")]),_:2},1032,["loading-status","onClick"])])])]),e("td",null,i(s.product.unit),1),e("td",G,[s.product.price===s.product.origin_price?(r(),d("small",J," 折扣價： ")):b("",!0),m(" "+i(s.product.price),1)]),e("td",K,i(s.final_total),1)]))),128)):b("",!0)]),e("tfoot",null,[e("tr",null,[Q,e("td",W,i(t.cart.total),1)]),e("tr",null,[X,e("td",Y,i(t.cart.final_total),1)])])])],64)):(r(),d("p",Z,"購物車沒有項目")),e("div",ee,[o(L,{ref:"form",class:"col-md-6",onSubmit:V.postOrder},{default:_(({errors:s})=>[e("div",se,[te,o(c,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":s.email}]),rules:"email|required",placeholder:"請輸入 Email",modelValue:n.user.email,"onUpdate:modelValue":l[1]||(l[1]=a=>n.user.email=a)},null,8,["class","modelValue"]),o(p,{name:"email",class:"invalid-feedback"})]),e("div",le,[ae,o(c,{id:"name",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:n.user.name,"onUpdate:modelValue":l[2]||(l[2]=a=>n.user.name=a)},null,8,["class","modelValue"]),o(p,{name:"姓名",class:"invalid-feedback"})]),e("div",oe,[ne,o(c,{id:"tel",name:"電話",type:"tel",class:h(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",modelValue:n.user.tel,"onUpdate:modelValue":l[3]||(l[3]=a=>n.user.tel=a),rules:V.isPhone},null,8,["class","modelValue","rules"]),o(p,{name:"電話",class:"invalid-feedback"})]),e("div",de,[re,o(c,{id:"address",name:"地址",type:"text",class:h(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:n.user.address,"onUpdate:modelValue":l[4]||(l[4]=a=>n.user.address=a)},null,8,["class","modelValue"]),o(p,{name:"地址",class:"invalid-feedback"})]),e("div",ie,[ce,o(c,{name:"message",id:"message",class:"form-control",cols:"30",rows:"10",modelValue:n.message,"onUpdate:modelValue":l[5]||(l[5]=a=>n.message=a),as:"textarea"},null,8,["modelValue"])]),ue]),_:1},8,["onSubmit"])])],64)}const fe=x(N,[["render",me]]);export{fe as default};
