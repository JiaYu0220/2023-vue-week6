import{_ as C,m as f,e as k,c as l,b as u,a as t,F as c,f as w,r as h,o,t as s,n as P,i as b,w as E,d as V}from"./index-rQ1ecwA4.js";import{L as B,a as T,l as S}from"./alertStore-FvkRcQaP.js";import{P as x}from"./PaginationComponent-hmKrfnKF.js";var D={VITE_URL:"https://ec-course-api.hexschool.io/v2",VITE_PATH:"jiayu",BASE_URL:"/2023-vue-week6/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_PATH:m}=D,A={data(){return{orders:[],pagination:{}}},mounted(){this.showLoading(),this.getOrders()},methods:{async getOrders(e=1){try{const n=`${p}/api/${m}/admin/orders?page=${e}`,i=await this.$http.get(n);this.orders=i.data.orders,this.pagination=i.data.pagination}catch(n){this.$swal(n.data.message||"發生錯誤")}finally{this.hideLoading()}},async delOrder(e){try{if((await this.confirmSwal("確定要刪除此訂單嗎？")).isConfirmed){this.loadingStatus.delOrder=e;const i=`${p}/api/${m}/admin/order/${e}`,d=await this.$http.delete(i);this.getOrders(),this.miniSwal(d.data.message)}}catch(n){this.$swal(n.data.message||"發生錯誤")}finally{this.loadingStatus.delOrder=""}},async handlePaidStatus(e){try{const n={...e,is_paid:!e.is_paid},i=`${p}/api/${m}/admin/order/${e.id}`,d=await this.$http.put(i,{data:n});this.getOrders(),this.miniSwal(d.data.message)}catch(n){this.$swal(n.data.message||"發生錯誤")}},...f(T,["confirmSwal","miniSwal"]),...f(S,["showLoading","hideLoading"])},computed:{...k(S,["isLoading","loadingStatus"])},components:{LoadingButton:B,PaginationComponent:x}},R={class:"table table-striped table-bordered mt-4"},I=t("thead",null,[t("tr",null,[t("th",null,"訂單編號"),t("th",null,"聯絡人"),t("th",null,"聯絡地址"),t("th",null,"電子郵件"),t("th",null,"訂單品項"),t("th",null,"訂單總額"),t("th",null,"訂單日期"),t("th",null,"訂單狀態"),t("th",null,"操作")])],-1),N={class:"text-end"},U=["onClick"];function F(e,n,i,d,g,_){const $=h("LoadingOverlay"),L=h("LoadingButton"),y=h("PaginationComponent");return o(),l(c,null,[u($,{active:e.isLoading},null,8,["active"]),t("table",R,[I,t("tbody",null,[(o(!0),l(c,null,w(g.orders,(a,O)=>(o(),l("tr",{key:a.id},[t("td",null,s(O+1),1),t("td",null,[t("p",null,s(a.user.name),1),t("p",null,s(a.user.tel),1)]),t("td",null,s(a.user.address),1),t("td",null,s(a.user.email),1),t("td",null,[(o(!0),l(c,null,w(a.products,(r,v)=>(o(),l("p",{key:v},s(`${r.product.title} * ${r.qty}`),1))),128))]),t("td",N,s(a.total),1),t("td",null,s(new Date(a.create_at*1e3).toLocaleDateString()),1),t("td",null,[t("a",{class:P({"text-danger":!a.is_paid}),href:"#",onClick:b(r=>_.handlePaidStatus(a),["prevent"])},s(a.is_paid?"已付款":"未付款"),11,U)]),t("td",null,[u(L,{class:"btn-danger","loading-status":e.loadingStatus.delOrder===a.id,onClick:r=>_.delOrder(a.id)},{default:E(()=>[V("刪除")]),_:2},1032,["loading-status","onClick"])])]))),128))])]),u(y,{pagination:g.pagination},null,8,["pagination"])],64)}const q=C(A,[["render",F]]);export{q as default};
